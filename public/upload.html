<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload - Rebecca's 30th Birthday Photos & Videos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="fancy-text">Rebecca's</span> <span class="birthday-text">30th</span> <span class="photo-text">Birthday Photos & Videos</span> ðŸŽ‰</h1>
            <nav>
                <a href="/">Home</a>
                <a href="/upload.html" class="active">Upload Photos & Videos</a>
                <a href="/gallery.html">Gallery</a>
            </nav>
        </header>

        <main>
            <section class="upload-section">
                <h2>Upload Your Photos & Videos</h2>
                <form id="uploadForm" class="upload-form">
                    <div class="file-input-container">
                        <input type="file" id="imageInput" name="media" accept="image/*,video/*" multiple required>
                        <label for="imageInput" class="custom-file-input">Choose photos & videos</label>
                    </div>
                    <div class="upload-info">
                        <p>Supported formats:</p>
                        <ul>
                            <li>Images: JPG, PNG, GIF</li>
                            <li>Videos: MP4, MOV, AVI</li>
                            <li>Max file size: 100MB</li>
                        </ul>
                    </div>
                    <div id="preview" class="image-preview-grid"></div>
                    <button type="submit" class="btn">Upload Files</button>
                </form>
                <div id="uploadStatus" class="upload-status"></div>
                <div id="uploadProgress" class="upload-progress-container">
                    <div class="upload-progress-text">Uploading: <span id="uploadCount">0/0</span></div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill"></div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>ðŸ“¸ Capture the moments, share the joy! ðŸŽ‰</p>
        </footer>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');
        const status = document.getElementById('uploadStatus');
        const progressContainer = document.getElementById('uploadProgress');
        const progressBar = document.querySelector('.progress-bar-fill');
        const uploadCount = document.getElementById('uploadCount');

        // Preview media before upload
        imageInput.addEventListener('change', function() {
            preview.innerHTML = '';
            const files = Array.from(this.files);
            
            files.forEach(file => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                if (file.type.startsWith('video/')) {
                    // Create video preview
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.controls = true;
                    previewItem.appendChild(video);
                } else {
                    // Create image preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = "Preview";
                        previewItem.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                }

                // Add filename overlay
                const overlay = document.createElement('div');
                overlay.className = 'preview-overlay';
                overlay.innerHTML = `<span class="preview-filename">${file.name}</span>`;
                previewItem.appendChild(overlay);
                
                preview.appendChild(previewItem);
            });
        });

        // Handle form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const files = Array.from(imageInput.files);
            
            if (files.length === 0) {
                status.textContent = 'Please select at least one file';
                status.className = 'upload-status error';
                return;
            }

            status.textContent = 'Uploading...';
            status.className = 'upload-status';
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            uploadCount.textContent = `0/${files.length}`;

            try {
                let successCount = 0;
                const totalFiles = files.length;

                for (let i = 0; i < files.length; i++) {
                    const formData = new FormData();
                    formData.append('media', files[i]);

                    try {
                        console.log(`Uploading file ${i + 1}/${totalFiles}: ${files[i].name}`);
                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (!response.ok) {
                            throw new Error(result.message || `HTTP error! status: ${response.status}`);
                        }
                        
                        if (result.success) {
                            console.log(`Successfully uploaded ${files[i].name}`);
                            successCount++;
                            uploadCount.textContent = `${successCount}/${totalFiles}`;
                            progressBar.style.width = `${(successCount / totalFiles) * 100}%`;
                        } else {
                            throw new Error(result.message || 'Upload failed');
                        }
                    } catch (error) {
                        console.error(`Error uploading ${files[i].name}:`, error);
                        status.textContent = `Error uploading ${files[i].name}: ${error.message}`;
                        status.className = 'upload-status error';
                    }
                }

                if (successCount === totalFiles) {
                    status.textContent = 'All files uploaded successfully!';
                    status.className = 'upload-status success';
                    setTimeout(() => {
                        form.reset();
                        preview.innerHTML = '';
                        progressContainer.style.display = 'none';
                        window.location.href = '/gallery.html';
                    }, 1500);
                } else if (successCount > 0) {
                    status.textContent = `Uploaded ${successCount} out of ${totalFiles} files`;
                    status.className = 'upload-status warning';
                } else {
                    status.textContent = 'Failed to upload files. Please try again.';
                    status.className = 'upload-status error';
                }
            } catch (error) {
                console.error('Upload error:', error);
                status.textContent = `Error uploading files: ${error.message}`;
                status.className = 'upload-status error';
                progressContainer.style.display = 'none';
            }
        });
    </script>
</body>
</html> 